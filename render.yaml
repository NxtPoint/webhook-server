services:
  # =========================================
  # 1) SportAI / Upload / Webhook API service
  # =========================================
  - type: web
    name: webhook-server
    env: python
    plan: free
    buildCommand: "pip install --upgrade pip && pip install -r requirements.txt"
    startCommand: "gunicorn wsgi:app --bind 0.0.0.0:$PORT --workers 2 --threads 4 --timeout 120"
    envVars:
      - key: PYTHON_VERSION
        value: "3.12.3"

      - key: DROPBOX_APP_KEY
        sync: false
      - key: DROPBOX_APP_SECRET
        sync: false
      - key: DROPBOX_REFRESH_TOKEN
        sync: false
      - key: DROPBOX_UPLOAD_FOLDER
        value: "/wix-uploads"

      - key: SPORT_AI_TOKEN
        sync: false
      - key: SPORT_AI_BASE
        value: "https://api.sportai.com"

      - key: INGEST_REPLACE_EXISTING
        value: "1"
      - key: AUTO_INGEST_ON_COMPLETE
        value: "1"

      - key: S3_BUCKET
        sync: false
      - key: S3_PREFIX
        value: "wix-uploads"
      - key: AWS_REGION
        value: "us-east-1"
      - key: S3_GET_EXPIRES
        value: "604800"
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false

      - key: DATABASE_URL
        sync: false


  # =========================================
  # 2) Power BI embed/refresh service
  # =========================================
  - type: web
    name: powerbi-service
    env: python
    plan: free
    buildCommand: "pip install --upgrade pip && pip install -r requirements.txt"
    startCommand: "gunicorn powerbi_app:app --bind 0.0.0.0:$PORT --workers 2 --threads 4 --timeout 120"
    envVars:
      - key: PYTHON_VERSION
        value: "3.12.3"

      - key: OPS_KEY
        sync: false

      - key: PBI_TENANT_ID
        sync: false
      - key: PBI_CLIENT_ID
        sync: false
      - key: PBI_CLIENT_SECRET
        sync: false

      - key: PBI_WORKSPACE_ID
        sync: false
      - key: PBI_REPORT_ID
        sync: false
      - key: PBI_DATASET_ID
        sync: false

      - key: AZ_SUBSCRIPTION_ID
        sync: false
      - key: AZ_RESOURCE_GROUP
        sync: false
      - key: AZ_CAPACITY_NAME
        sync: false
